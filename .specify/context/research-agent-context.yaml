# Research Agent Context
# Complete context for the speckit.research agent
#
# This file is read by the research agent at startup to understand:
# - Project structure and file locations
# - Research methodology and standards
# - Integration points with SpecKit
# - Decision-making criteria

# =============================================================================
# FILE LOCATIONS
# =============================================================================

paths:
  # Research Infrastructure
  research_root: "dev/research"
  research_plan: "dev/research/research-plan.yaml"
  research_template: "dev/research/research-template.yaml"
  decision_log: "dev/research/decision-log.yaml"
  feedback_integration: "dev/research/feedback-integration.yaml"
  master_doc: "dev/research/MASTER.md"

  # Research Area Pattern
  area_folder_pattern: "dev/research/{folder}" # e.g., dev/research/01-go-http-client
  area_research_yaml: "{area_folder}/research.yaml"
  area_findings_md: "{area_folder}/findings.md"

  # Project Context
  constitution: ".specify/memory/constitution.md"
  roadmap: "dev/roadmap.yaml"
  feature_specs: "dev/specs/features"
  architecture_docs: "dev/architecture"
  sprint_plans: "dev/sprints"

  # Agent Files
  agent_definition: ".github/agents/speckit.research.agent.md"
  agent_prompt: ".github/prompts/speckit.research.prompt.md"
  helper_script: ".specify/scripts/bash/research.sh"
  tool_definitions: ".specify/tools/research-tools.yaml"

# =============================================================================
# RESEARCH AREAS (R01-R10)
# =============================================================================

research_areas:
  R01:
    folder: "01-go-http-client"
    name: "Go HTTP Client Libraries"
    focus: "HTTP client selection for Go core (grab vs stdlib)"
    target_version: "1.0.0"
    blocks: ["F011"]

  R02:
    folder: "02-bubble-tea-tui"
    name: "Bubble Tea TUI Framework"
    focus: "TUI architecture patterns, component design"
    target_version: "1.1.0"
    blocks: ["F014"]

  R03:
    folder: "03-rate-limiting"
    name: "Rate Limiting Algorithms"
    focus: "Token bucket vs leaky bucket, io.Reader wrapping"
    target_version: "1.0.0"
    blocks: ["F011"]

  R04:
    folder: "04-accessibility"
    name: "Accessible Terminal UI Patterns"
    focus: "Screen reader compatibility, WCAG terminal compliance"
    target_version: "0.2.0"
    blocks: ["F008", "F014"]

  R05:
    folder: "05-state-migration"
    name: "State Migration Strategies"
    focus: "JSON schema evolution, atomic file operations"
    target_version: "1.0.0"
    blocks: ["F010", "F011"]

  R06:
    folder: "06-gpg-verification"
    name: "GPG Signature Verification"
    focus: "Pure Go vs system gpg, key management UX"
    target_version: "1.2.0"
    blocks: ["F017"]

  R07:
    folder: "07-package-managers"
    name: "Package Manager Publishing"
    focus: "Homebrew, Debian, RPM packaging automation"
    target_version: "1.3.0"
    blocks: ["F021", "F022", "F023"]

  R08:
    folder: "08-rest-api"
    name: "REST API Design Patterns"
    focus: "Go framework selection, WebSocket vs SSE"
    target_version: "2.0.0"
    blocks: ["F025"]

  R09:
    folder: "09-plugin-system"
    name: "Plugin System Architectures"
    focus: "go-plugin vs subprocess vs WASM"
    target_version: "1.2.0"
    blocks: ["F020"]

  R10:
    folder: "10-cross-platform"
    name: "Cross-Platform Distribution"
    focus: "CGO avoidance, static linking, code signing"
    target_version: "1.0.0"
    blocks: ["F013"]

# =============================================================================
# RESEARCH METHODOLOGY
# =============================================================================

methodology:
  # Task Types
  task_types:
    library_evaluation:
      description: "Evaluate a library/framework for potential use"
      checklist:
        - "Fetch repository metadata (stars, license, last update)"
        - "Read documentation and examples"
        - "Check dependency count and tree"
        - "Review open issues (especially bugs)"
        - "Find example projects using it"
        - "Score against decision criteria"

    pattern_research:
      description: "Research implementation patterns or approaches"
      checklist:
        - "Search for authoritative sources"
        - "Study reference implementations"
        - "Extract code examples"
        - "Document pros/cons"
        - "Note when to use/avoid"

    documentation_review:
      description: "Gather and synthesize documentation"
      checklist:
        - "Identify official documentation"
        - "Extract relevant sections"
        - "Note version-specific info"
        - "Identify gaps requiring further research"

  # Confidence Levels
  confidence_levels:
    CERTAIN:
      definition: "100% confident, verified from authoritative source"
      when_to_use: "Official docs, tested locally, consensus across sources"
    HIGH:
      definition: "90%+ confident, strong evidence"
      when_to_use: "Multiple reliable sources agree, fits known patterns"
    MEDIUM:
      definition: "70-90% confident, some uncertainty"
      when_to_use: "Single good source, or extrapolating from similar cases"
    LOW:
      definition: "<70% confident, significant uncertainty"
      when_to_use: "Limited sources, conflicting information, inference"

  # Source Credibility
  source_ranking:
    tier_1:
      - "Official documentation"
      - "Source code"
      - "Project maintainer communications"
    tier_2:
      - "Well-known technical blogs"
      - "Conference talks by experts"
      - "Reputable books"
    tier_3:
      - "Stack Overflow (accepted answers)"
      - "Community blog posts"
      - "GitHub issues/discussions"

# =============================================================================
# DECISION CRITERIA
# =============================================================================

decision_criteria:
  weights:
    constitution_alignment: 25
    performance: 20
    maintainability: 20
    developer_experience: 15
    community_support: 10
    dependency_footprint: 10

  scoring:
    scale: "0-100"
    pass_threshold: 60
    recommend_threshold: 75

  constitution_principles:
    I: "Resumable Downloads - resume as core feature"
    II: "Optional Features - enhanced features must be optional"
    III: "Single Binary - no runtime dependencies"
    V: "Privacy - no telemetry, analytics"
    VI: "Structured Output - JSON output flag"
    VIII: "Minimal Dependencies - prefer stdlib"
    IX: "Accessibility - screen reader support required"
    X: "Security Posture - defense in depth"
    XI: "Professional UX - high visual standards"

  performance_gates:
    tui_startup: "<500ms"
    list_downloads: "<100ms"
    resume_calculation: "<50ms"
    cancel_response: "<200ms"

# =============================================================================
# OUTPUT FORMATS
# =============================================================================

output_formats:
  library_comparison:
    template: |
      | Aspect | {lib_a} | {lib_b} | {lib_c} |
      |--------|---------|---------|---------|
      | Stars | {stars_a} | {stars_b} | {stars_c} |
      | License | {license_a} | {license_b} | {license_c} |
      | Last Update | {update_a} | {update_b} | {update_c} |
      | Dependencies | {deps_a} | {deps_b} | {deps_c} |
      | {feature} Support | {support_a} | {support_b} | {support_c} |
      | Learning Curve | {curve_a} | {curve_b} | {curve_c} |
      | **Score** | **{score_a}** | **{score_b}** | **{score_c}** |

  question_answer:
    template: |
      ### Q: {question}

      **Answer**: {answer}

      **Confidence**: {confidence}

      **Sources**:
      {sources_list}

      **Caveats**:
      {caveats_list}

  decision_summary:
    template: |
      ## Decision: {title}

      **Selection**: {selection}

      **Rationale**: {rationale}

      **Trade-offs Accepted**:
      {tradeoffs_list}

      **Fallback Plan**: {fallback}

# =============================================================================
# INTEGRATION WORKFLOW
# =============================================================================

integration:
  on_complete:
    steps:
      - action: "Update research.yaml status to 'complete'"
        fields:
          - "metadata.status"
          - "metadata.actual_hours"
          - "metadata.completed"

      - action: "Update research-plan.yaml"
        fields:
          - "research_areas[id].status"
          - "research_areas[id].actual_hours"
          - "research_areas[id].completed_date"
          - "statistics.completed"
          - "statistics.completion_percentage"
          - "checklist_by_version.*.checklist[].status"

      - action: "Add decision to decision-log.yaml (if applicable)"
        condition: "Research produces clear recommendation"
        fields:
          - "decisions[] (new entry)"
          - "metadata.total_decisions"
          - "metadata.decisions_pending"

      - action: "Update feedback-integration.yaml"
        fields:
          - "current_status.by_research_area[id].status"
          - "current_status.summary.*"

  affected_files:
    feature_specs:
      pattern: "dev/specs/features/F{blocks}.yaml"
      section: "implementation"
      update_trigger: "Library selection or architecture decision"

    architecture_docs:
      pattern: "dev/architecture/*.md"
      files:
        - "core-migration.md (Go core decisions)"
        - "tui-stack.md (TUI framework decisions)"
        - "state-schema.md (State management decisions)"
      update_trigger: "Significant architecture insight"

    sprint_plans:
      pattern: "dev/sprints/*.yaml"
      update_trigger: "Research unblocks sprint tasks"
      action: "Remove pending_research blockers"

# =============================================================================
# AGENT BEHAVIOR RULES
# =============================================================================

behavior:
  # What the agent MUST do
  requirements:
    - "Always check constitution alignment before finalizing decisions"
    - "Always cite sources with URLs"
    - "Always record confidence levels for answers"
    - "Always update all affected status files"
    - "Always present research brief before starting"
    - "Always offer next steps after completion"

  # What the agent MUST NOT do
  prohibitions:
    - "Do not recommend options that violate constitution principles"
    - "Do not skip questions - mark as LOW confidence if uncertain"
    - "Do not proceed without user confirmation (unless --auto flag)"
    - "Do not modify files outside research directory without noting"

  # Preferences
  preferences:
    - "Prefer official documentation over community sources"
    - "Prefer stdlib over external dependencies"
    - "Prefer well-maintained libraries (commits in last 6 months)"
    - "Prefer MIT/BSD/Apache licenses"
    - "Prefer libraries with good documentation"

  # Error handling
  error_handling:
    question_unanswerable:
      action: "Record as LOW confidence with explanation"
      next: "Add to 'Open Questions' in findings.md"

    library_unmaintained:
      threshold: "No commits in 12 months"
      action: "Flag as risk in evaluation"
      recommendation: "Consider alternatives or forking"

    conflicting_sources:
      action: "Document all perspectives"
      next: "Recommend local testing to verify"

# =============================================================================
# VERSION MAPPING
# =============================================================================

version_research_map:
  "0.2.0":
    name: "Shield"
    required_research: ["R04"]
    description: "Accessibility research needed for basic TUI"

  "1.0.0":
    name: "Phoenix"
    required_research: ["R01", "R03", "R05", "R10"]
    description: "Go core migration research"

  "1.1.0":
    name: "Bubble"
    required_research: ["R02"]
    description: "Bubble Tea TUI framework research"

  "1.2.0":
    name: "Velocity"
    required_research: ["R06", "R09"]
    description: "GPG and plugin system research"

  "1.3.0":
    name: "Ecosystem"
    required_research: ["R07"]
    description: "Package manager research"

  "2.0.0":
    name: "Horizon"
    required_research: ["R08"]
    description: "REST API research"
